<!DOCTYPE busconfig PUBLIC
 "-//freedesktop//DTD D-BUS Bus Configuration 1.0//EN"
 "http://www.freedesktop.org/standards/dbus/1.0/busconfig.dtd">
<busconfig>
  <!-- Only root can own the daemon service -->
  <policy user="root">
    <allow own="org.dots.FamilyDaemon"/>
    <allow send_destination="org.dots.FamilyDaemon"/>
    <allow receive_sender="org.dots.FamilyDaemon"/>
    <allow send_interface="org.dots.FamilyDaemon"/>
  </policy>

  <!-- Users in the dots-family group can use most methods -->
  <policy group="dots-family">
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="get_active_profile"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="check_application_allowed"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="get_remaining_time"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="list_profiles"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="validate_session"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="request_parent_permission"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="request_command_approval"/>
    
    <!-- Receive signals from daemon -->
    <allow receive_sender="org.dots.FamilyDaemon"
           receive_interface="org.dots.FamilyDaemon"
           receive_member="policy_updated"/>
    <allow receive_sender="org.dots.FamilyDaemon"
           receive_interface="org.dots.FamilyDaemon"
           receive_member="time_limit_warning"/>
    <allow receive_sender="org.dots.FamilyDaemon"
           receive_interface="org.dots.FamilyDaemon"
           receive_member="tamper_detected"/>
  </policy>

  <!-- Monitor processes need to send heartbeats and report activity -->
  <policy user="dots-monitor">
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="report_activity"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="send_heartbeat"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="check_application_allowed"/>
    
    <!-- Receive policy updates -->
    <allow receive_sender="org.dots.FamilyDaemon"
           receive_interface="org.dots.FamilyDaemon"
           receive_member="policy_updated"/>
  </policy>

  <!-- Parent users (in dots-parents group) have administrative privileges -->
  <policy group="dots-parents">
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="authenticate_parent"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="create_profile"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="set_active_profile"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="revoke_session"/>
    
    <!-- Also inherit regular user permissions -->
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="get_active_profile"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="check_application_allowed"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="get_remaining_time"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="list_profiles"/>
    <allow send_destination="org.dots.FamilyDaemon"
           send_interface="org.dots.FamilyDaemon"
           send_member="validate_session"/>
    
    <!-- Receive all signals -->
    <allow receive_sender="org.dots.FamilyDaemon"
           receive_interface="org.dots.FamilyDaemon"/>
  </policy>

  <!-- Default deny policy -->
  <policy context="default">
    <deny send_destination="org.dots.FamilyDaemon"/>
    <deny receive_sender="org.dots.FamilyDaemon"/>
  </policy>
</busconfig>